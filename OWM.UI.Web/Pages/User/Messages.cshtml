@page "{handler?}/{BoardId?}"
@model MessagesModel
@{
    Layout = "Shared/UserLayout";
}
<script src="https://timeago.yarp.com/jquery.timeago.js"></script>
<link href="~/css/Messages.css" rel="stylesheet" />
<h4 class="font-weight-bold">Messages</h4>
<hr class="mb-0 mb-3" />
<div class="row">
    <div class="col-md-12">
        <div class="card">
            <div class="card-header bg-success">
                <div class="btn-group">
                    <button class="btn btn-light btn-sm dropdown-toggle" type="button" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                        @if (Model.TeamBoards.Any(x => x.BoardId == Model.BoardId))
                        {
                            <span>@Model.TeamBoards.First(x => x.BoardId == Model.BoardId).TeamName</span>
                        }
                        else
                        {
                            <span>Select a team</span>
                        }
                    </button>
                    <div class="dropdown-menu">
                        @foreach (var board in Model.TeamBoards)
                        {
                            if (Model.BoardId == board.BoardId)
                            {
                                <a class="dropdown-item active" href="/User/Messages/Board/@board.BoardId">
                                    @board.TeamName
                                    @if (board.UnreadMessages != 0)
                                    {
                                        <span class="badge badge-success">@board.UnreadMessages</span>
                                    }
                                </a>
                            }
                            else
                            {
                                <a class="dropdown-item" href="/User/Messages/Board/@board.BoardId">
                                    @board.TeamName
                                    @if (board.UnreadMessages != 0)
                                    {
                                        <span class="badge badge-success">@board.UnreadMessages</span>
                                    }
                                </a>
                            }
                        }
                    </div>
                </div>
            </div>
            <div class="card-body" style="height: 400px; overflow-x: auto;" id="boardbody">
                @if (Model.EmptyState)
                {
                    <div class="container h-100">
                        <div class="row h-100 justify-content-center align-items-center x-small">
                            <div class="d-block p-1 rounded bg-light">
                                <span class="fa fa-envelope-open d-block text-center mb-1"></span>
                                Select a team to see the message board
                            </div>
                        </div>  
                    </div>
                }
                else
                {
                    <ul class="chat">
                        @foreach (var message in Model.BoardMessages)
                        {
                            <li class="left clearfix">
                                <span class="float-left">
                                    <img src="@message.Sender.ProfilePicture" alt="@message.Sender.FullName" class="rounded-circle" style="width: 40px; height: 40px;" />
                                </span>
                                <div class="chat-body clearfix">
                                    <div class="header pb-1">
                                        <strong>@message.Sender.FullName</strong>
                                        <small class="float-right text-muted xx-small" id="time">
                                            <i class="far fa-clock"></i>
                                            <time class="timeago" datetime="@message.Date"></time>
                                        </small>
                                    </div>
                                    <p class="small mt-1 mb-2">
                                        @message.Text
                                    </p>
                                </div>
                            </li>
                        }
                    </ul>
                }
            </div>
            @if (!Model.EmptyState)
            {
                <div class="card-footer clearfix">
                    <form method="post">
                        <textarea class="form-control" rows="3" id="message" placeholder="Type message here... " style="resize: none;" asp-for="MessageText"></textarea>
                        <span class="col-lg-6 col-md-6">
                            <button type="submit" asp-route-BoardId="@Model.BoardId" class="btn btn-warning btn-lg btn-block" id="btn-chat">Send</button>
                        </span>
                    </form>
                </div>
            }
        </div>
    </div>
</div>
<script>
    $(function () {
        jQuery("time.timeago").timeago();
        var objDiv = document.getElementById("boardbody");
        objDiv.scrollTop = objDiv.scrollHeight;
    })
    document.addEventListener("DOMContentLoaded", function () { window.addEventListener("pagehide", function (a) { window.name += "\ue000" + window.pageXOffset + "\ue000" + window.pageYOffset }); if (window.name && -1 < window.name.indexOf("\ue000")) { var a = window.name.split("\ue000"); 3 <= a.length && (window.name = a[0], window.scrollTo(parseFloat(a[a.length - 2]), parseFloat(a[a.length - 1]))) } });
</script>